<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Tracking</title>
    <script>
        // Función para obtener los parámetros de la URL
        function getURLParams(param) {
            var urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        window.onload = function() {
            // Captura los parámetros de la URL
            var emailSubject = getURLParams('email_subject') || 'default_subject';
            var emailRecipient = getURLParams('email_recipient') || 'default_recipient';
            var campaignName = getURLParams('campaign_name') || 'default_campaign';

            // Tu Measurement ID y API Secret
            var measurementId = 'G-EGT50HQ4HV'; // Measurement ID 
            var apiSecret = 'AS8LGwkHSbSffQ2aXOMlRw'; // API Secret

            // Crear la solicitud de seguimiento usando fetch con no-cors
            fetch(`https://www.google-analytics.com/mp/collect?measurement_id=${measurementId}&api_secret=${apiSecret}`, {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    client_id: '123456789', // Puede ser cualquier identificador único del cliente
                    events: [
                        {
                            name: 'email_open',
                            params: {
                                email_subject: emailSubject,
                                email_recipient: emailRecipient,
                                campaign_name: campaignName
                            }
                        }
                    ]
                }),
                mode: 'no-cors' // Importante para evitar el bloqueo de CORB
            }).then(() => {
                console.log('Tracking request sent with params: ', emailSubject, emailRecipient, campaignName);
            }).catch((error) => {
                console.error('Error in tracking:', error);
            });
        };
    </script>
</head>
<body>
    <h1>Email Tracking</h1>
    <p>This page tracks the opening of an email using Google Analytics 4.</p>
</body>
</html>
